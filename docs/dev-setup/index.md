Building the for the first time can be a bit daunting.

We strongly recommend first building for the platform you are on. For example if you're on a windows machine, make a windows build; a mac, make a mac build etc.

When building for android and iOS you will be cross-compiling (building for a different platform than the machine you're on) which can make things a little trickier.

To try and provide a smooth dev experience we focus on ensuring that a minimal set of workflows are always working. There's nothing stopping you from using your preferred tools and workflows, but you are in the wild.

# Checking out the source code

```bash
git clone https://github.com/mozilla-mobile/mozilla-vpn-client.git
cd mozilla-vpn-client
git submodule update --init
```

# Building

## Conda
Wherever possible, dependencies are managed using [conda](https://docs.conda.io/en/latest/miniconda.html).
Please install [miniconda](https://docs.conda.io/en/latest/miniconda.html).

Then run:
* `conda env create -f env.yaml`
* `conda activate vpn`

## Building for each platform

All other dependency installation is discussed in each platform page:
* [Linux](./linux.md)
   * Build on Linux
   * Develop in VS Code
* [Windows](./windows.md)
   * Build on Windows
   * Develop in Visual Studio
* [Mac](./macos.md)
   * Build on Mac
   * Develop in VS Code or XCode
* [Android](./android.md)
   * Build on Linux, Mac, or Windows
   * Develop in VS Code
* [iOS](./ios.md)
   * Build on Mac
   * Develop in VS Code or XCode
   * XCode required to build
* [wasm](./wasm.md)

Before submitting a Pull Request, please, install the clang format pre-commit hook: `./scripts/git-pre-commit-format install`. See [here](/README.md) for more details.

## Build targets

* The default target builds the mozillavpn client
* `build_tests` builds the unit tests
* `dummyvpn` is needed for the functional tests

## Standard build flags

The following are cmake flags that you may need to use.
cmake flags are passed to the command line argument with `-D` e.g. the flag `CMAKE_BUILD_TYPE` would be set by adding `-DCMAKE_BUILD_TYPE=Release` to your cmake command.

* `CMAKE_PREFIX_PATH=<Qt install path>/lib/cmake`: can be set if CMake is unable
   to locate a viable Qt installation in your `PATH`. (This may be an error message
   like `Unknown CMake command "qt_add_executable‚Äù.`)
* `CMAKE_BUILD_TYPE=Release`: can be set to generate a release build, otherwise a
  Debug build is generated by default.
* `BUILD_TESTING=ON`: can be set to build, and execute the unit tests using `CTest`
* `BUILD_ID=<string>`: sets the build identifier that will be embedded into the project. If
  left unset, this will generate a timestamp when configuring the Makefiles.
* `CMAKE_INSTALL_PREFIX`: the install path prefix e.g. `/usr`

# Useful scripts

* `./scripts/utils/bake_shaders.sh`: if you want to change the shaders
* `./scripts/addon/generate_all_tests.py`: compiles the testing addons, needed for functional tests

# Troubleshooting

## git clean if you're having build troubles
It's easy for your local build to get messed up. When in doubt do a `git clean` to blow away all generated files.
Running `git clean -xfdi .` from the root of the folder provides you an interactive space where you can review everything that's going to be deleted. You may want to exclude `.vscode` or `.env` that you've set-up just the way you like.

## did you activate your conda environment
You'll need to run `conda activate vpn` everytime you open a new terminal. If you forget and then run cmake the build can get confused / stuck. `git clean`, make sure conda environment is activated, try again.

## ask for help
We are on a mission to make building easy for devs. If you've tried the above two steps, don't get stuck ask for help.
