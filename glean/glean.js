var Glean;(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{default:()=>bt});var n,r="0.11.0",i="glean_ping_info",o="glean_client_info",a="c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0",s="deletion-request",u=new Uint8Array(16);function c(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(u)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function(e){return"string"==typeof e&&l.test(e)};for(var p=[],h=0;h<256;++h)p.push((h+256).toString(16).substr(1));const d=function(e,t,n){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase();if(!f(n))throw TypeError("Stringified UUID is invalid");return n}(r)};function b(e){if(g(e)||w(e)||m(e))return!0;if(v(e)){if(0===Object.keys(e).length)return!0;for(var t in e)return b(e[t])}return!!Array.isArray(e)&&e.every((function(e){return b(e)}))}function v(e){return"object"==typeof e&&null!==e&&e.constructor===Object}function y(e){return void 0===e}function g(e){return"string"==typeof e||"object"==typeof e&&null!==e&&e.constructor===String}function w(e){return"boolean"==typeof e||"object"==typeof e&&null!==e&&e.constructor===Boolean}function m(e){return("number"==typeof e||"object"==typeof e&&null!==e&&e.constructor===Number)&&!isNaN(e)}function _(e){return/^[a-z0-9-]{1,20}$/i.test(e)}function P(){return"undefined"!=typeof crypto?d():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function x(){return"undefined"==typeof performance?Date.now():performance.now()}var S,O=function(){function e(t){if(this.appBuild=null==t?void 0:t.appBuild,this.appDisplayVersion=null==t?void 0:t.appDisplayVersion,this.debug=e.sanitizeDebugOptions(null==t?void 0:t.debug),(null==t?void 0:t.serverEndpoint)&&(n=t.serverEndpoint,!/^(http|https):\/\/[a-zA-Z0-9._-]+(:\d+){0,1}(\/{0,1})$/i.test(n)))throw new Error("Unable to initialize Glean, serverEndpoint "+t.serverEndpoint+" is an invalid URL.");var n;this.serverEndpoint=t&&t.serverEndpoint?t.serverEndpoint:"https://incoming.telemetry.mozilla.org",this.httpClient=null==t?void 0:t.httpClient}return e.sanitizeDebugOptions=function(t){var n=t||{};return void 0===(null==t?void 0:t.debugViewTag)||e.validateDebugViewTag(null==t?void 0:t.debugViewTag)||delete n.debugViewTag,void 0===(null==t?void 0:t.sourceTags)||e.validateSourceTags(null==t?void 0:t.sourceTags)||delete n.sourceTags,n},e.validateDebugViewTag=function(e){var t=_(e);return t||console.error('"'+e+'" is not a valid `debugViewTag` value.',"Please make sure the value passed satisfies the regex `^[a-zA-Z0-9-]{1,20}$`."),t},e.validateSourceTags=function(e){if(e.length<1||e.length>5)return console.error("A list of tags cannot contain more than 5 elements."),!1;for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.startsWith("glean"))return console.error("Tags starting with `glean` are reserved and must not be used."),!1;if(!_(r))return!1}return!0},e}(),T=function(){function e(e){if(!this.validate(e))throw new Error("Unable to create new Metric instance, values is in unexpected format.");this._inner=e}return e.prototype.get=function(){return this._inner},e.prototype.set=function(e){this.validate(e)?this._inner=e:console.error("Unable to set metric to "+JSON.stringify(e)+". Value is in unexpected format. Ignoring.")},e}(),k=(S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),I=function(){return(I=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},D=function(e){function t(t){return e.call(this,t)||this}return k(t,e),t.prototype.validate=function(e){return!0},t.prototype.payload=function(){return this._inner},t}(T),U="__other__",E=/^[a-z_][a-z0-9_-]{0,29}(\.[a-z_][a-z0-9_-]{0,29})*$/;function j(e,t){return e+"/"+t}function M(e,t){return n=this,r=void 0,o=function(){var n,r,i,o,a,s,u,c,l;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(f){switch(f.label){case 0:if(void 0===t.dynamicLabel)throw new Error("This point should never be reached.");n=j(t.baseIdentifier(),t.dynamicLabel),r=0,i=t.sendInPings,f.label=1;case 1:return r<i.length?(u=i[r],[4,e.hasMetric(t.lifetime,u,t.type,n)]):[3,4];case 2:if(f.sent())return[2,n];f.label=3;case 3:return r++,[3,1];case 4:o=0,a=0,s=t.sendInPings,f.label=5;case 5:return a<s.length?(u=s[a],c=o,[4,e.countByBaseIdentifier(t.lifetime,u,t.type,t.baseIdentifier())]):[3,8];case 6:o=c+f.sent(),f.label=7;case 7:return a++,[3,5];case 8:return l=!1,o>=16?l=!0:t.dynamicLabel.length>61?(console.error("label length "+t.dynamicLabel.length+" exceeds maximum of 61"),l=!0):E.test(t.dynamicLabel)||(console.error("label must be snake_case, got '"+t.dynamicLabel+"'"),l=!0),[2,l?j(t.baseIdentifier(),U):n]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{u(o.next(e))}catch(e){t(e)}}function s(e){try{u(o.throw(e))}catch(e){t(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}u((o=o.apply(n,r||[])).next())}));var n,r,i,o}!function(){function e(t,n,r){return new Proxy(this,{get:function(i,o){return r?e.createFromStaticLabel(t,n,r,o):e.createFromDynamicLabel(t,n,o)}})}e.createFromStaticLabel=function(e,t,n,r){var i=n.includes(r)?r:U;return new t(I(I({},e),{name:j(e.name,i)}))},e.createFromDynamicLabel=function(e,t,n){return new t(I(I({},e),{dynamicLabel:n}))}}();var z,C,G=function(){function e(e,t){this.type=e,this.name=t.name,this.category=t.category,this.sendInPings=t.sendInPings,this.lifetime=t.lifetime,this.disabled=t.disabled,this.dynamicLabel=t.dynamicLabel}return e.prototype.baseIdentifier=function(){return this.category.length>0?this.category+"."+this.name:this.name},e.prototype.identifier=function(e){return t=this,n=void 0,i=function(){var t;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:return t=this.baseIdentifier(),y(this.dynamicLabel)?[3,2]:[4,M(e,this)];case 1:return[2,n.sent()];case 2:return[2,t]}}))},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}u((i=i.apply(t,n||[])).next())}));var t,n,r,i},e.prototype.shouldRecord=function(e){return e&&!this.disabled},e}(),V=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},A=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Idle=1]="Idle",e[e.Processing=2]="Processing",e[e.Stopped=3]="Stopped"}(z||(z={})),function(e){e[e.Task=0]="Task",e[e.Stop=1]="Stop",e[e.Clear=2]="Clear",e[e.TestTask=3]="TestTask"}(C||(C={}));const L=function(){function e(e){void 0===e&&(e=100),this.maxPreInitQueueSize=e,this.queue=[],this.state=0}return e.prototype.getNextCommand=function(){return this.queue.shift()},e.prototype.executeTask=function(e){return V(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),console.error("Error executing task:",t),[3,3];case 3:return[2]}}))}))},e.prototype.execute=function(){return V(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:e=this.getNextCommand(),t.label=1;case 1:if(!e)return[3,9];switch(e.command){case 1:return[3,2];case 2:return[3,3];case 3:return[3,4];case 0:return[3,6]}return[3,8];case 2:return this.state=3,[2];case 3:return this.queue.forEach((function(e){3===e.command&&e.resolver()})),this.queue=[],this.state=3,[2];case 4:return[4,this.executeTask(e.task)];case 5:return t.sent(),e.resolver(),e=this.getNextCommand(),[3,1];case 6:return[4,this.executeTask(e.task)];case 7:t.sent(),e=this.getNextCommand(),t.label=8;case 8:return[3,1];case 9:return[2]}}))}))},e.prototype.triggerExecution=function(){var e=this;1===this.state&&this.queue.length>0&&(this.state=2,this.currentJob=this.execute(),this.currentJob.then((function(){e.currentJob=void 0,2===e.state&&(e.state=1)})).catch((function(e){console.error("IMPOSSIBLE: Something went wrong while the dispatcher was executing the tasks queue.",e)})))},e.prototype.launchInternal=function(e,t){return void 0===t&&(t=!1),!t&&0===this.state&&this.queue.length>=this.maxPreInitQueueSize?(console.warn("Unable to enqueue task, pre init queue is full."),!1):(t?this.queue.unshift(e):this.queue.push(e),this.triggerExecution(),!0)},e.prototype.launch=function(e){this.launchInternal({task:e,command:0})},e.prototype.flushInit=function(e){0===this.state?(e&&this.launchInternal({task:e,command:0},!0),this.state=1,this.triggerExecution()):console.warn("Attempted to initialize the Dispatcher, but it is already initialized. Ignoring.")},e.prototype.clear=function(){this.launchInternal({command:2},!0),this.resume()},e.prototype.stop=function(){this.launchInternal({command:1},!0)},e.prototype.resume=function(){3===this.state&&(this.state=1,this.triggerExecution())},e.prototype.testBlockOnQueue=function(){return V(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:return(e=this.currentJob)?[4,this.currentJob]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return[2,e]}}))}))},e.prototype.testUninitialize=function(){return V(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return 0===this.state?[2]:(this.clear(),[4,this.testBlockOnQueue()]);case 1:return e.sent(),this.state=0,[2]}}))}))},e.prototype.testLaunch=function(e){var t=this;return new Promise((function(n,r){t.resume(),t.launchInternal({resolver:n,task:e,command:3})||r()}))},e}();var R=function(){function e(){this._initialized=!1}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e.testUninitialize=function(){return t=this,n=void 0,i=function(){return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(t){switch(t.label){case 0:return e.instance._dispatcher?[4,e.instance._dispatcher.testUninitialize()]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.instance._dispatcher=null,e.initialized=!1,[2]}}))},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}u((i=i.apply(t,n||[])).next())}));var t,n,r,i},Object.defineProperty(e,"dispatcher",{get:function(){return e.instance._dispatcher||(e.instance._dispatcher=new L),e.instance._dispatcher},set:function(t){e.instance._dispatcher=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"uploadEnabled",{get:function(){return e.instance._uploadEnabled},set:function(t){e.instance._uploadEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"metricsDatabase",{get:function(){return e.instance._metricsDatabase},set:function(t){e.instance._metricsDatabase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"eventsDatabase",{get:function(){return e.instance._eventsDatabase},set:function(t){e.instance._eventsDatabase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"pingsDatabase",{get:function(){return e.instance._pingsDatabase},set:function(t){e.instance._pingsDatabase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"applicationId",{get:function(){return e.instance._applicationId},set:function(t){e.instance._applicationId=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"initialized",{get:function(){return e.instance._initialized},set:function(t){e.instance._initialized=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugOptions",{get:function(){return e.instance._debugOptions},set:function(t){e.instance._debugOptions=t},enumerable:!1,configurable:!0}),e}(),N=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},J=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},B=function(e){function t(t){return e.call(this,t)||this}return N(t,e),t.prototype.validate=function(e){return w(e)},t.prototype.payload=function(){return this._inner},t}(T);const F=function(e){function t(t){return e.call(this,"boolean",t)||this}return N(t,e),t.prototype.set=function(e){var t=this;R.dispatcher.launch((function(){return q(t,void 0,void 0,(function(){var t;return J(this,(function(n){switch(n.label){case 0:return this.shouldRecord(R.uploadEnabled)?(t=new B(e),[4,R.metricsDatabase.record(this,t)]):[2];case 1:return n.sent(),[2]}}))}))}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),q(this,void 0,void 0,(function(){var t,n=this;return J(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return q(n,void 0,void 0,(function(){return J(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,t]}}))}))},t}(G);var K=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},X=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},H=function(e){function t(t){return e.call(this,t)||this}return K(t,e),t.prototype.validate=function(e){return!(!m(e)||e<=0)},t.prototype.payload=function(){return this._inner},t}(T);const W=function(e){function t(t){return e.call(this,"counter",t)||this}return K(t,e),t._private_addUndispatched=function(e,t){return Q(this,void 0,void 0,(function(){var n;return X(this,(function(r){switch(r.label){case 0:return e.shouldRecord(R.uploadEnabled)?(y(t)&&(t=1),t<=0?(console.warn("Attempted to add an invalid amount "+t+". Ignoring."),[2]):(n=function(e){return function(t){var n,r;try{r=(n=new H(t)).get()+e}catch(t){n=new H(e),r=e}return r>Number.MAX_SAFE_INTEGER&&(r=Number.MAX_SAFE_INTEGER),n.set(r),n}}(t),[4,R.metricsDatabase.transform(e,n)])):[2];case 1:return r.sent(),[2]}}))}))},t.prototype.add=function(e){var n=this;R.dispatcher.launch((function(){return Q(n,void 0,void 0,(function(){return X(this,(function(n){return[2,t._private_addUndispatched(this,e)]}))}))}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),Q(this,void 0,void 0,(function(){var t,n=this;return X(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return Q(n,void 0,void 0,(function(){return X(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,t]}}))}))},t}(G);var $;!function(e){e.Nanosecond="nanosecond",e.Microsecond="microsecond",e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day"}($||($={}));const Y=$;var Z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ee=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},te=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ne=function(e){function t(t){return e.call(this,t)||this}return Z(t,e),t.fromDate=function(e,n){return new t({timeUnit:n,timezone:e.getTimezoneOffset(),date:e.toISOString()})},Object.defineProperty(t.prototype,"date",{get:function(){return new Date(this._inner.date)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timezone",{get:function(){return this._inner.timezone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timeUnit",{get:function(){return this._inner.timeUnit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dateISOString",{get:function(){return this._inner.date},enumerable:!1,configurable:!0}),t.prototype.validate=function(e){if(!v(e)||3!==Object.keys(e).length)return!1;var t="timeUnit"in e&&g(e.timeUnit)&&Object.values(Y).includes(e.timeUnit),n="timezone"in e&&m(e.timezone),r="date"in e&&g(e.date)&&24===e.date.length&&!isNaN(Date.parse(e.date));return!!(t&&n&&r)},t.prototype.payload=function(){var e=this.dateISOString.match(/\d+/g);if(!e||e.length<0)throw new Error("IMPOSSIBLE: Unable to extract date information from DatetimeMetric.");var t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]),parseInt(e[3])-this.timezone/60,parseInt(e[4]),parseInt(e[5]),parseInt(e[6])),n=function(e){var t=e/60*-1;return(t>0?"+":"-")+Math.abs(t).toString().padStart(2,"0")+":00"}(this.timezone),r=t.getFullYear().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");if(this.timeUnit===Y.Day)return r+"-"+i+"-"+o+n;var a=t.getHours().toString().padStart(2,"0");if(this.timeUnit===Y.Hour)return r+"-"+i+"-"+o+"T"+a+n;var s=t.getMinutes().toString().padStart(2,"0");if(this.timeUnit===Y.Minute)return r+"-"+i+"-"+o+"T"+a+":"+s+n;var u=t.getSeconds().toString().padStart(2,"0");if(this.timeUnit===Y.Second)return r+"-"+i+"-"+o+"T"+a+":"+s+":"+u+n;var c=t.getMilliseconds().toString().padStart(3,"0");return this.timeUnit===Y.Millisecond?r+"-"+i+"-"+o+"T"+a+":"+s+":"+u+"."+c+n:this.timeUnit===Y.Microsecond?r+"-"+i+"-"+o+"T"+a+":"+s+":"+u+"."+c+"000"+n:r+"-"+i+"-"+o+"T"+a+":"+s+":"+u+"."+c+"000000"+n},t}(T);const re=function(e){function t(t,n){var r=e.call(this,"datetime",t)||this;return r.timeUnit=n,r}return Z(t,e),t._private_setUndispatched=function(e,t){return ee(this,void 0,void 0,(function(){var n,r;return te(this,(function(i){switch(i.label){case 0:if(!e.shouldRecord(R.uploadEnabled))return[2];switch(t||(t=new Date),n=t,e.timeUnit){case Y.Day:n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setMilliseconds(0);case Y.Hour:n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0);case Y.Minute:n.setMilliseconds(0),n.setSeconds(0);case Y.Second:n.setMilliseconds(0)}return r=ne.fromDate(t,e.timeUnit),[4,R.metricsDatabase.record(e,r)];case 1:return i.sent(),[2]}}))}))},t.prototype.set=function(e){var n=this;R.dispatcher.launch((function(){return t._private_setUndispatched(n,e)}))},t.prototype.testGetValueAsDatetimeMetric=function(e){return ee(this,void 0,void 0,(function(){var t,n=this;return te(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return ee(n,void 0,void 0,(function(){return te(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),t?[2,new ne(t)]:[2]}}))}))},t.prototype.testGetValueAsString=function(e){return void 0===e&&(e=this.sendInPings[0]),ee(this,void 0,void 0,(function(){var t;return te(this,(function(n){switch(n.label){case 0:return[4,this.testGetValueAsDatetimeMetric(e)];case 1:return[2,(t=n.sent())?t.payload():void 0]}}))}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),ee(this,void 0,void 0,(function(){var t;return te(this,(function(n){switch(n.label){case 0:return[4,this.testGetValueAsDatetimeMetric(e)];case 1:return[2,(t=n.sent())?t.date:void 0]}}))}))},t}(G);var ie=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),oe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},ae=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},se=function(e){function t(t){return e.call(this,t)||this}return ie(t,e),t.prototype.validate=function(e){return!(!g(e)||e.length>100)},t.prototype.payload=function(){return this._inner},t}(T);const ue=function(e){function t(t){return e.call(this,"string",t)||this}return ie(t,e),t._private_setUndispatched=function(e,t){return oe(this,void 0,void 0,(function(){var n;return ae(this,(function(r){switch(r.label){case 0:return e.shouldRecord(R.uploadEnabled)?(t.length>100&&console.warn("String "+t+" is longer than 100 chars. Truncating."),n=new se(t.substr(0,100)),[4,R.metricsDatabase.record(e,n)]):[2];case 1:return r.sent(),[2]}}))}))},t.prototype.set=function(e){var n=this;R.dispatcher.launch((function(){return t._private_setUndispatched(n,e)}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),oe(this,void 0,void 0,(function(){var t,n=this;return ae(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return oe(n,void 0,void 0,(function(){return ae(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,t]}}))}))},t}(G);var ce=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),le=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},fe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},pe=function(e){function t(t){return e.call(this,t)||this}return ce(t,e),t.prototype.validate=function(e){if(!v(e)||2!==Object.keys(e).length)return!1;var t="timeUnit"in e&&g(e.timeUnit)&&Object.values(Y).includes(e.timeUnit),n="timespan"in e&&m(e.timespan)&&e.timespan>=0;return!(!t||!n)},t.prototype.payload=function(){switch(this._inner.timeUnit){case Y.Nanosecond:return this._inner.timespan*Math.pow(10,6);case Y.Microsecond:return this._inner.timespan*Math.pow(10,3);case Y.Millisecond:return this._inner.timespan;case Y.Second:return Math.round(this._inner.timespan/1e3);case Y.Minute:return Math.round(this._inner.timespan/1e3/60);case Y.Hour:return Math.round(this._inner.timespan/1e3/60/60);case Y.Day:return Math.round(this._inner.timespan/1e3/60/60/24)}},t}(T);!function(e){function t(t,n){var r=e.call(this,"timespan",t)||this;return r.timeUnit=n,r}ce(t,e),t.prototype.start=function(){var e=this,t=x();R.dispatcher.launch((function(){return le(e,void 0,void 0,(function(){return fe(this,(function(e){return this.shouldRecord(R.uploadEnabled)?y(this.startTime)?(this.startTime=t,[2,Promise.resolve()]):(console.error("Timespan already started."),[2]):[2]}))}))}))},t.prototype.stop=function(){var e=this,t=x();R.dispatcher.launch((function(){return le(e,void 0,void 0,(function(){var e,n,r,i=this;return fe(this,(function(o){switch(o.label){case 0:return this.shouldRecord(R.uploadEnabled)?y(this.startTime)?(console.error("Timespan not running."),[2]):(e=t-this.startTime,this.startTime=void 0,e<0?(console.error("Timespan was negative."),[2]):(n=!1,r=function(e){return function(t){var r;try{r=new pe(t),n=!0}catch(t){r=new pe({timespan:e,timeUnit:i.timeUnit})}return r}}(e),[4,R.metricsDatabase.transform(this,r)])):(this.startTime=void 0,[2]);case 1:return o.sent(),n&&console.error("Timespan value already recorded. New value discarded."),[2]}}))}))}))},t.prototype.cancel=function(){var e=this;R.dispatcher.launch((function(){return e.startTime=void 0,Promise.resolve()}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),le(this,void 0,void 0,(function(){var t,n=this;return fe(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return le(n,void 0,void 0,(function(){return fe(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),t?[2,new pe(t).payload()]:[2]}}))}))}}(G);var he=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},be=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ve=function(e){function t(t){return e.call(this,t)||this}return he(t,e),t.prototype.validate=function(e){return!!g(e)&&(e===a||f(e))},t.prototype.payload=function(){return this._inner},t}(T);const ye=function(e){function t(t){return e.call(this,"uuid",t)||this}return he(t,e),t._private_setUndispatched=function(e,t){return de(this,void 0,void 0,(function(){var n;return be(this,(function(r){switch(r.label){case 0:if(!e.shouldRecord(R.uploadEnabled))return[2];t||(t=P());try{n=new ve(t)}catch(e){return console.warn('"'+t+'" is not a valid UUID. Ignoring'),[2]}return[4,R.metricsDatabase.record(e,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.set=function(e){var n=this;R.dispatcher.launch((function(){return t._private_setUndispatched(n,e)}))},t.prototype.generateAndSet=function(){if(this.shouldRecord(R.uploadEnabled)){var e=P();return this.set(e),e}},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),de(this,void 0,void 0,(function(){var t,n=this;return be(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return de(n,void 0,void 0,(function(){return be(this,(function(n){switch(n.label){case 0:return[4,R.metricsDatabase.getMetric(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,t]}}))}))},t}(G);var ge=Object.freeze({boolean:B,counter:H,datetime:ne,labeled_boolean:D,labeled_counter:D,labeled_string:D,string:se,timespan:pe,uuid:ve});function we(e,t){if(!(e in ge))throw new Error("Unable to create metric of unknown type "+e);return new ge[e](t)}function me(e,t){try{return we(e,t),!0}catch(e){return!1}}var _e=function(){return(_e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Pe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},xe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};function Se(e){var t={};for(var n in e){var r=e[n];for(var i in t[n]={},r){var o=we(n,r[i]);t[n][i]=o.payload()}}return t}const Oe=function(){function e(e){this.userStore=new e("userLifetimeMetrics"),this.pingStore=new e("pingLifetimeMetrics"),this.appStore=new e("appLifetimeMetrics")}return e.prototype._chooseStore=function(e){switch(e){case"user":return this.userStore;case"ping":return this.pingStore;case"application":return this.appStore}},e.prototype.record=function(e,t){return Pe(this,void 0,void 0,(function(){return xe(this,(function(n){switch(n.label){case 0:return[4,this.transform(e,(function(){return t}))];case 1:return n.sent(),[2]}}))}))},e.prototype.transform=function(e,t){return Pe(this,void 0,void 0,(function(){var n,r,i,o,a,s;return xe(this,(function(u){switch(u.label){case 0:return e.disabled?[2]:(n=this._chooseStore(e.lifetime),[4,e.identifier(this)]);case 1:r=u.sent(),i=0,o=e.sendInPings,u.label=2;case 2:return i<o.length?(a=o[i],s=function(e){return t(e).get()},[4,n.update([a,e.type,r],s)]):[3,5];case 3:u.sent(),u.label=4;case 4:return i++,[3,2];case 5:return[2]}}))}))},e.prototype.hasMetric=function(e,t,n,r){return Pe(this,void 0,void 0,(function(){return xe(this,(function(i){switch(i.label){case 0:return[4,this._chooseStore(e).get([t,n,r])];case 1:return[2,!y(i.sent())]}}))}))},e.prototype.countByBaseIdentifier=function(e,t,n,r){return Pe(this,void 0,void 0,(function(){var i;return xe(this,(function(o){switch(o.label){case 0:return[4,this._chooseStore(e).get([t,n])];case 1:return y(i=o.sent())?[2,0]:[2,Object.keys(i).filter((function(e){return e.startsWith(r)})).length]}}))}))},e.prototype.getMetric=function(e,t){return Pe(this,void 0,void 0,(function(){var n,r,i;return xe(this,(function(o){switch(o.label){case 0:return n=this._chooseStore(t.lifetime),[4,t.identifier(this)];case 1:return r=o.sent(),[4,n.get([e,t.type,r])];case 2:return y(i=o.sent())||me(t.type,i)?[3,4]:(console.error("Unexpected value found for metric "+r+": "+JSON.stringify(i)+". Clearing."),[4,n.delete([e,t.type,r])]);case 3:return o.sent(),[2];case 4:return[2,i]}}))}))},e.prototype.getAndValidatePingData=function(e,t){return Pe(this,void 0,void 0,(function(){var n,r;return xe(this,(function(i){switch(i.label){case 0:return[4,(n=this._chooseStore(t)).get([e])];case 1:return y(r=i.sent())?[2,{}]:function(e){if(v(e)){for(var t in e){var n=e[t];if(!v(n))return!1;for(var r in n)if(!me(t,n[r]))return!1}return!0}return!1}(r)?[3,3]:(console.error("Unexpected value found for ping "+e+" in "+t+" store: "+JSON.stringify(r)+". Clearing."),[4,n.delete([e])]);case 2:return i.sent(),[2,{}];case 3:return[2,r]}}))}))},e.prototype.processLabeledMetric=function(e,t,n,r){var i,o,a,s="labeled_"+t,u=n.split("/",2),c=u[0],l=u[1];if(s in e&&c in e[s]){var f=e[s][c];e[s][c]=_e(_e({},f),((i={})[l]=r,i))}else e[s]=_e(_e({},e[s]),((o={})[c]=((a={})[l]=r,a),o))},e.prototype.getPingMetrics=function(e,t){return Pe(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,f;return xe(this,(function(p){switch(p.label){case 0:return[4,this.getAndValidatePingData(e,"user")];case 1:return n=p.sent(),[4,this.getAndValidatePingData(e,"ping")];case 2:return r=p.sent(),[4,this.getAndValidatePingData(e,"application")];case 3:return i=p.sent(),t?[4,this.clear("ping",e)]:[3,5];case 4:p.sent(),p.label=5;case 5:for(o={},a=0,s=[n,r,i];a<s.length;a++)for(c in u=s[a])for(l in u[c])l.includes("/")?this.processLabeledMetric(o,c,l,u[c][l]):o[c]=_e(_e({},o[c]),((f={})[l]=u[c][l],f));return 0===Object.keys(o).length?[2]:[2,Se(o)]}}))}))},e.prototype.clear=function(e,t){return Pe(this,void 0,void 0,(function(){var n,r;return xe(this,(function(i){switch(i.label){case 0:return n=this._chooseStore(e),r=t?[t]:[],[4,n.delete(r)];case 1:return i.sent(),[2]}}))}))},e.prototype.clearAll=function(){return Pe(this,void 0,void 0,(function(){return xe(this,(function(e){switch(e.label){case 0:return[4,this.userStore.delete([])];case 1:return e.sent(),[4,this.pingStore.delete([])];case 2:return e.sent(),[4,this.appStore.delete([])];case 3:return e.sent(),[2]}}))}))},e}();var Te=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},ke=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};const Ie=function(){function e(e){this.store=new e("pings")}return e.prototype.attachObserver=function(e){this.observer=e},e.prototype.recordPing=function(e,t,n,r){return Te(this,void 0,void 0,(function(){var i;return ke(this,(function(o){switch(o.label){case 0:return i={path:e,payload:n},r&&(i.headers=r),[4,this.store.update([t],(function(){return i}))];case 1:return o.sent(),this.observer&&this.observer.update(t,i),[2]}}))}))},e.prototype.deletePing=function(e){return Te(this,void 0,void 0,(function(){return ke(this,(function(t){switch(t.label){case 0:return[4,this.store.delete([e])];case 1:return t.sent(),[2]}}))}))},e.prototype.getAllPings=function(){return Te(this,void 0,void 0,(function(){var e,t,n,r,i,o,a;return ke(this,(function(s){switch(s.label){case 0:return[4,this.store._getWholeStore()];case 1:for(r in e=s.sent(),t={},n=[],e)n.push(r);i=0,s.label=2;case 2:return i<n.length?(o=n[i],function(e){if(v(e)&&(2===Object.keys(e).length||3===Object.keys(e).length)){var t="path"in e&&g(e.path),n="payload"in e&&b(e.payload)&&v(e.payload),r=!("headers"in e)||b(e.headers)&&v(e.headers);return!!(t&&n&&r)}return!1}(a=e[o])?(t[o]=a,[3,5]):[3,3]):[3,6];case 3:return console.warn("Unexpected data found in pings database. Deleting."),[4,this.store.delete([o])];case 4:s.sent(),s.label=5;case 5:return i++,[3,2];case 6:return[2,t]}}))}))},e.prototype.scanPendingPings=function(){return Te(this,void 0,void 0,(function(){var e,t;return ke(this,(function(n){switch(n.label){case 0:return this.observer?[4,this.getAllPings()]:[2];case 1:for(t in e=n.sent())this.observer.update(t,e[t]);return[2]}}))}))},e.prototype.clearAll=function(){return Te(this,void 0,void 0,(function(){return ke(this,(function(e){switch(e.label){case 0:return[4,this.store.delete([])];case 1:return e.sent(),[2]}}))}))},e}();var De,Ue=function(){return(Ue=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ee=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},je=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};!function(e){e[e.Idle=0]="Idle",e[e.Uploading=1]="Uploading",e[e.Cancelling=2]="Cancelling"}(De||(De={}));const Me=function(){function e(e,t,n){this.initialized=!1,this.queue=[],this.status=0,this.uploader=e.httpClient?e.httpClient:t.uploader,this.platformInfo=t.info,this.serverEndpoint=e.serverEndpoint,this.pingsDatabase=n}return e.prototype.setInitialized=function(e){this.initialized=null==e||e},e.prototype.enqueuePing=function(e){for(var t=!1,n=0,r=this.queue;n<r.length;n++)r[n].identifier===e.identifier&&(t=!0);!t&&this.queue.push(e)},e.prototype.getNextPing=function(){return this.queue.shift()},e.prototype.preparePingForUpload=function(e){return Ee(this,void 0,void 0,(function(){var t,n,i,o,a;return je(this,(function(s){switch(s.label){case 0:return t=JSON.stringify(e.payload),e.headers,n=[Ue({},e.headers)],a={"Content-Type":"application/json; charset=utf-8","Content-Length":t.length.toString(),Date:(new Date).toISOString(),"X-Client-Type":"Glean.js","X-Client-Version":r},i="User-Agent",o="Glean/0.11.0 (JS on ",[4,this.platformInfo.os()];case 1:return[2,{headers:Ue.apply(void 0,n.concat([(a[i]=o+s.sent()+")",a)])),payload:t}]}}))}))},e.prototype.attemptPingUpload=function(e){return Ee(this,void 0,void 0,(function(){var t;return je(this,(function(n){switch(n.label){case 0:return this.initialized?[4,this.preparePingForUpload(e)]:(console.warn("Attempted to upload a ping, but Glean is not initialized yet. Ignoring."),[2,{result:0}]);case 1:return t=n.sent(),[4,this.uploader.post(""+this.serverEndpoint+e.path,t.payload,t.headers)];case 2:return[2,n.sent()]}}))}))},e.prototype.processPingUploadResponse=function(e,t){return Ee(this,void 0,void 0,(function(){var n,r;return je(this,(function(i){switch(i.label){case 0:return n=t.status,r=t.result,n&&n>=200&&n<300?(console.info("Ping "+e+" succesfully sent "+n+"."),[4,this.pingsDatabase.deletePing(e)]):[3,2];case 1:return i.sent(),[2,!1];case 2:return 1===r||n&&n>=400&&n<500?(console.warn("Unrecoverable upload failure while attempting to send ping "+e+". Error was "+(null!=n?n:"no status")+"."),[4,this.pingsDatabase.deletePing(e)]):[3,4];case 3:return i.sent(),[2,!1];case 4:return console.warn("Recoverable upload failure while attempting to send ping "+e+", will retry. Error was "+(null!=n?n:"no status")+"."),[2,!0]}}))}))},e.prototype.triggerUploadInternal=function(){return Ee(this,void 0,void 0,(function(){var e,t,n;return je(this,(function(r){switch(r.label){case 0:e=0,t=this.getNextPing(),r.label=1;case 1:return t&&2!==this.status?[4,this.attemptPingUpload(t)]:[3,4];case 2:return n=r.sent(),[4,this.processPingUploadResponse(t.identifier,n)];case 3:return r.sent()&&(e++,this.enqueuePing(t)),e>=3?(console.info("Reached maximum recoverable failures for the current uploading window. You are done."),[2]):(t=this.getNextPing(),[3,1]);case 4:return[2]}}))}))},e.prototype.triggerUpload=function(){return Ee(this,void 0,void 0,(function(){return je(this,(function(e){switch(e.label){case 0:if(0!==this.status)return[2];this.status=1,e.label=1;case 1:return e.trys.push([1,,3,4]),this.currentJob=this.triggerUploadInternal(),[4,this.currentJob];case 2:return e.sent(),[3,4];case 3:return this.status=0,[7];case 4:return[2]}}))}))},e.prototype.cancelUpload=function(){return Ee(this,void 0,void 0,(function(){return je(this,(function(e){switch(e.label){case 0:return 1!==this.status?[3,2]:(this.status=2,[4,this.currentJob]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearPendingPingsQueue=function(){return Ee(this,void 0,void 0,(function(){return je(this,(function(e){switch(e.label){case 0:return[4,this.cancelUpload()];case 1:return e.sent(),this.queue=[],[2]}}))}))},e.prototype.update=function(e,t){this.enqueuePing(Ue({identifier:e},t)),this.triggerUpload()},e}();var ze=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Ce=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Ge=function(){function e(){this.clientId=new ye({name:"client_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.firstRunDate=new re({name:"first_run_date",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1},Y.Day),this.os=new ue({name:"os",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.osVersion=new ue({name:"os_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.architecture=new ue({name:"architecture",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.locale=new ue({name:"locale",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appBuild=new ue({name:"app_build",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appDisplayVersion=new ue({name:"app_display_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1})}return e.prototype.initialize=function(e,t,n){return ze(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l,f,p,h,d;return Ce(this,(function(b){switch(b.label){case 0:return[4,this.initializeClientId(n)];case 1:return b.sent(),[4,this.initializeFirstRunDate(n)];case 2:return b.sent(),i=(r=ue)._private_setUndispatched,o=[this.os],[4,t.info.os()];case 3:return[4,i.apply(r,o.concat([b.sent()]))];case 4:return b.sent(),s=(a=ue)._private_setUndispatched,u=[this.osVersion],[4,t.info.osVersion()];case 5:return[4,s.apply(a,u.concat([b.sent()]))];case 6:return b.sent(),l=(c=ue)._private_setUndispatched,f=[this.architecture],[4,t.info.arch()];case 7:return[4,l.apply(c,f.concat([b.sent()]))];case 8:return b.sent(),h=(p=ue)._private_setUndispatched,d=[this.locale],[4,t.info.locale()];case 9:return[4,h.apply(p,d.concat([b.sent()]))];case 10:return b.sent(),[4,ue._private_setUndispatched(this.appBuild,e.appBuild||"Unknown")];case 11:return b.sent(),[4,ue._private_setUndispatched(this.appDisplayVersion,e.appDisplayVersion||"Unknown")];case 12:return b.sent(),[2]}}))}))},e.prototype.initializeClientId=function(e){return ze(this,void 0,void 0,(function(){var t,n;return Ce(this,(function(r){switch(r.label){case 0:return t=!1,[4,e.getMetric(o,this.clientId)];case 1:if(n=r.sent())try{we("uuid",n).payload()===a&&(t=!0)}catch(e){console.warn("Unexpected value found for Glean clientId. Ignoring."),t=!0}else t=!0;return t?[4,ye._private_setUndispatched(this.clientId,P())]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.initializeFirstRunDate=function(e){return ze(this,void 0,void 0,(function(){return Ce(this,(function(t){switch(t.label){case 0:return[4,e.getMetric(o,this.firstRunDate)];case 1:return t.sent()?[3,3]:[4,re._private_setUndispatched(this.firstRunDate)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e}(),Ve=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Ae=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Le=function(){function e(e,t,n,r){this.category=e,this.name=t,this.timestamp=n,this.extra=r}return e.toJSONObject=function(e){return{category:e.category,name:e.name,timestamp:e.timestamp,extra:e.extra}},e.fromJSONObject=function(t){return new e(t.category,t.name,t.timestamp,t.extra)},e}();const Re=function(){function e(e){this.eventsStore=new e("events")}return e.prototype.record=function(e,t){return Ve(this,void 0,void 0,(function(){var n,r,i,o;return Ae(this,(function(a){switch(a.label){case 0:if(e.disabled)return[2];n=0,r=e.sendInPings,a.label=1;case 1:return n<r.length?(i=r[n],o=function(e){var n,r=null!==(n=e)&&void 0!==n?n:[];return r.push(Le.toJSONObject(t)),r},[4,this.eventsStore.update([i],o)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.getEvents=function(e,t){return Ve(this,void 0,void 0,(function(){var n;return Ae(this,(function(r){switch(r.label){case 0:return[4,this.getAndValidatePingData(e)];case 1:return 0===(n=r.sent()).length?[2]:[2,n.filter((function(e){return e.category===t.category&&e.name===t.name}))]}}))}))},e.prototype.getAndValidatePingData=function(e){return Ve(this,void 0,void 0,(function(){var t;return Ae(this,(function(n){switch(n.label){case 0:return[4,this.eventsStore.get([e])];case 1:return y(t=n.sent())?[2,[]]:Array.isArray(t)?[3,3]:(console.error("Unexpected value found for ping "+e+": "+JSON.stringify(t)+". Clearing."),[4,this.eventsStore.delete([e])]);case 2:return n.sent(),[2,[]];case 3:return[2,t.map((function(e){return Le.fromJSONObject(e)}))]}}))}))},e.prototype.getPingEvents=function(e,t){return Ve(this,void 0,void 0,(function(){var n,r,i;return Ae(this,(function(o){switch(o.label){case 0:return[4,this.getAndValidatePingData(e)];case 1:return n=o.sent(),t?[4,this.eventsStore.delete([e])]:[3,3];case 2:o.sent(),o.label=3;case 3:return 0===n.length?[2]:(r=n.sort((function(e,t){return e.timestamp-t.timestamp})),i=r[0].timestamp,[2,r.map((function(e){var t=Le.toJSONObject(e);return t.timestamp=e.timestamp-i,t}))])}}))}))},e.prototype.clearAll=function(){return Ve(this,void 0,void 0,(function(){return Ae(this,(function(e){switch(e.label){case 0:return[4,this.eventsStore.delete([])];case 1:return e.sent(),[2]}}))}))},e}(),Ne={afterPingCollection:new(function(){function e(e){this.name=e}return Object.defineProperty(e.prototype,"registeredPluginIdentifier",{get:function(){var e;return null===(e=this.plugin)||void 0===e?void 0:e.name},enumerable:!1,configurable:!0}),e.prototype.registerPlugin=function(e){this.plugin?console.error("Attempted to register plugin '"+e.name+"', which listens to the event '"+e.event+"'.","That event is already watched by plugin '"+this.plugin.name+"'","Plugin '"+e.name+"' will be ignored."):this.plugin=e},e.prototype.deregisterPlugin=function(){this.plugin=void 0},e.prototype.trigger=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this.plugin)return(e=this.plugin).action.apply(e,t)},e}())("afterPingCollection")};var qe=function(){return(qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Je=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Be=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Fe=new Date;function Ke(e,t){return Je(this,void 0,void 0,(function(){var n,r;return Be(this,(function(o){switch(o.label){case 0:return n=new W({category:"",name:t.name+"#sequence",sendInPings:[i],lifetime:"user",disabled:!1}),[4,e.getMetric(i,n)];case 1:return r=o.sent(),[4,W._private_addUndispatched(n,1)];case 2:if(o.sent(),r)try{return[2,new H(r).payload()]}catch(e){console.warn("Unexpected value found for sequence number in ping "+t.name+". Ignoring.")}return[2,0]}}))}))}function Qe(e,t){return Je(this,void 0,void 0,(function(){var n,r,o,a,s;return Be(this,(function(u){switch(u.label){case 0:return n=new re({category:"",name:t.name+"#start",sendInPings:[i],lifetime:"user",disabled:!1},Y.Minute),[4,e.getMetric(i,n)];case 1:return r=u.sent(),o=r?new ne(r):ne.fromDate(Fe,Y.Minute),a=new Date,[4,re._private_setUndispatched(n,a)];case 2:return u.sent(),s=ne.fromDate(a,Y.Minute),[2,{startTime:o.payload(),endTime:s.payload()}]}}))}))}function Xe(e,t,n){return Je(this,void 0,void 0,(function(){var r,i,o,a,s;return Be(this,(function(u){switch(u.label){case 0:return[4,Ke(e,t)];case 1:return r=u.sent(),[4,Qe(e,t)];case 2:return i=u.sent(),o=i.startTime,a=i.endTime,s={seq:r,start_time:o,end_time:a},n&&(s.reason=n),[2,s]}}))}))}function He(e,t){return Je(this,void 0,void 0,(function(){var n,i,a;return Be(this,(function(s){switch(s.label){case 0:return[4,e.getPingMetrics(o,!0)];case 1:for(a in(n=s.sent())||(console.warn("Empty client info data. Will submit anyways."),n={}),i={telemetry_sdk_build:r},n)i=qe(qe({},i),n[a]);return t.includeClientId||delete i.client_id,[2,i]}}))}))}function We(e,t,n,r){return Je(this,void 0,void 0,(function(){var i,o,a,s,u,c;return Be(this,(function(l){switch(l.label){case 0:return[4,e.getPingMetrics(n.name,!0)];case 1:return i=l.sent(),[4,t.getPingEvents(n.name,!0)];case 2:return o=l.sent(),i||o||n.sendIfEmpty?(i||console.info("Storage for "+n.name+" empty. Ping will still be sent."),a=i?{metrics:i}:{},s=o?{events:o}:{},[4,Xe(e,n,r)]):(console.info("Storage for "+n.name+" empty. Bailing out."),[2]);case 3:return u=l.sent(),[4,He(e,n)];case 4:return c=l.sent(),[2,qe(qe(qe({},a),s),{ping_info:u,client_info:c})]}}))}))}function $e(e,t,n){return"/submit/"+e+"/"+n.name+"/1/"+t}const Ye=function(e,t,n){return Je(this,void 0,void 0,(function(){var r,i,o,a,s;return Be(this,(function(u){switch(u.label){case 0:return[4,We(R.metricsDatabase,R.eventsDatabase,t,n)];case 1:if(!(r=u.sent()))return[2];u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Ne.afterPingCollection.trigger(r)];case 3:return i=u.sent(),[3,5];case 4:return o=u.sent(),console.error('Error while attempting to modify ping payload for the "'+t.name+'" ping using',"the "+JSON.stringify(Ne.afterPingCollection.registeredPluginIdentifier)+" plugin.","Ping will not be submitted. See more logs below.\n\n",o),[2];case 5:return R.debugOptions.logPings&&console.info(JSON.stringify(r,null,2)),a=i||r,s=function(e){var t={};if((null==e?void 0:e.debugViewTag)&&(t["X-Debug-ID"]=e.debugViewTag),(null==e?void 0:e.sourceTags)&&(t["X-Source-Tags"]=e.sourceTags.toString()),Object.keys(t).length>0)return t}(R.debugOptions),[2,R.pingsDatabase.recordPing($e(R.applicationId,e,t),e,a,s)]}}))}))};var Ze=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},et=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};const tt=function(){function e(e){var t;this.name=e.name,this.includeClientId=e.includeClientId,this.sendIfEmpty=e.sendIfEmpty,this.reasonCodes=null!==(t=e.reasonCodes)&&void 0!==t?t:[]}return e.prototype.isDeletionRequest=function(){return this.name===s},e.prototype.submit=function(t){var n=this;this.testCallback?this.testCallback(t).then((function(){e._private_internalSubmit(n,t,n.resolveTestPromiseFunction)})).catch((function(r){console.error('There was an error validating "'+n.name+'" ('+(null!=t?t:"no reason")+"):",r),e._private_internalSubmit(n,t,n.rejectTestPromiseFunction)})):e._private_internalSubmit(this,t)},e._private_internalSubmit=function(e,t,n){var r=this;R.dispatcher.launch((function(){return Ze(r,void 0,void 0,(function(){var r,i;return et(this,(function(o){switch(o.label){case 0:return R.initialized?R.uploadEnabled||e.isDeletionRequest()?(r=t,t&&!e.reasonCodes.includes(t)&&(console.error("Invalid reason code "+t+" from "+this.name+". Ignoring."),r=void 0),i=P(),[4,Ye(i,e,r)]):(console.info("Glean disabled: not submitting pings. Glean may still submit the deletion-request ping."),[2]):(console.info("Glean must be initialized before submitting pings."),[2]);case 1:return o.sent(),n&&(n(),e.resolveTestPromiseFunction=void 0,e.rejectTestPromiseFunction=void 0,e.testCallback=void 0),[2]}}))}))}))},e.prototype.testBeforeNextSubmit=function(e){return Ze(this,void 0,void 0,(function(){var t=this;return et(this,(function(n){return this.testCallback?(console.error('There is an existing test call for ping "'+this.name+'". Ignoring.'),[2]):[2,new Promise((function(n,r){t.resolveTestPromiseFunction=n,t.rejectTestPromiseFunction=r,t.testCallback=e}))]}))}))},e}(),nt=function(){this.deletionRequest=new tt({name:s,includeClientId:!0,sendIfEmpty:!0})};var rt=function(){return(rt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},it=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},ot={},at={os:function(){return Promise.resolve("Unknown")},osVersion:function(){return Promise.resolve("Unknown")},arch:function(){return Promise.resolve("Unknown")},locale:function(){return Promise.resolve("Unknown")}};const st={Storage:function(){function e(e){this.rootKey=e}return e.prototype._getWholeStore=function(){var e=ot[this.rootKey]||{};return Promise.resolve(e)},e.prototype.get=function(e){try{var t=function(e,t){if(0===t.length)throw Error("The index must contain at least one property to get.");for(var n=e,r=0,i=t;r<i.length;r++){var o=i[r];if(!v(n)||!(o in n))return;var a=n[o];b(a)&&(n=a)}return n}(ot,it([this.rootKey],e));return Promise.resolve(t)}catch(e){return Promise.reject(e)}},e.prototype.update=function(e,t){try{return ot=function(e,t,n){if(0===t.length)throw Error("The index must contain at least one property to update.");for(var r=rt({},e),i=r,o=0,a=t.slice(0,t.length-1);o<a.length;o++){var s=a[o];v(i[s])||(i[s]={}),i=i[s]}var u=t[t.length-1],c=i[u];try{var l=n(c);return i[u]=l,r}catch(e){return console.error("Error while transforming stored value. Ignoring old value.",e),i[u]=n(void 0),r}}(ot,it([this.rootKey],e),t),Promise.resolve()}catch(e){return Promise.reject(e)}},e.prototype.delete=function(e){try{ot=function(e,t){if(0===t.length)return{};for(var n=rt({},e),r=n,i=0,o=t.slice(0,t.length-1);i<o.length;i++){var a=r[o[i]];if(!v(a))throw Error("Attempted to delete an entry from an invalid index.");r=a}return delete r[t[t.length-1]],n}(ot,it([this.rootKey],e))}catch(e){console.warn(e.message,"Ignoring.")}return Promise.resolve()},e}(),uploader:new(function(){function e(){}return e.prototype.post=function(e,t,n){return Promise.resolve({result:2,status:200})},e}()),info:at,name:"test"};var ut=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},ct=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};const lt=function(){function e(){if(!y(e._instance))throw new Error("Tried to instantiate Glean through `new`.\n      Use Glean.instance instead to access the Glean singleton.");this._coreMetrics=new Ge,this._corePings=new nt}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e,"pingUploader",{get:function(){return e.instance._pingUploader},enumerable:!1,configurable:!0}),Object.defineProperty(e,"coreMetrics",{get:function(){return e.instance._coreMetrics},enumerable:!1,configurable:!0}),Object.defineProperty(e,"corePings",{get:function(){return e.instance._corePings},enumerable:!1,configurable:!0}),e.onUploadEnabled=function(){return ut(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return R.uploadEnabled=!0,[4,e.coreMetrics.initialize(e.instance._config,e.platform,R.metricsDatabase)];case 1:return t.sent(),[2]}}))}))},e.onUploadDisabled=function(){return ut(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return R.uploadEnabled=!1,[4,e.clearMetrics()];case 1:return t.sent(),e.corePings.deletionRequest.submit(),[2]}}))}))},e.clearMetrics=function(){return ut(this,void 0,void 0,(function(){var t,n;return ct(this,(function(r){switch(r.label){case 0:return[4,e.pingUploader.clearPendingPingsQueue()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),n=ne.bind,[4,R.metricsDatabase.getMetric(o,e.coreMetrics.firstRunDate)];case 3:return t=(new(n.apply(ne,[void 0,r.sent()]))).date,[3,5];case 4:return r.sent(),t=new Date,[3,5];case 5:return[4,R.eventsDatabase.clearAll()];case 6:return r.sent(),[4,R.metricsDatabase.clearAll()];case 7:return r.sent(),[4,R.pingsDatabase.clearAll()];case 8:return r.sent(),R.uploadEnabled=!0,[4,ye._private_setUndispatched(e.coreMetrics.clientId,a)];case 9:return r.sent(),[4,re._private_setUndispatched(e.coreMetrics.firstRunDate,t)];case 10:return r.sent(),R.uploadEnabled=!1,[2]}}))}))},e.initialize=function(t,n,r){var i,s,u=this;if(R.initialized)console.warn("Attempted to initialize Glean, but it has already been initialized. Ignoring.");else if(0!==t.length)if(e.instance._platform){var c=new O(r);if(R.metricsDatabase=new Oe(e.platform.Storage),R.eventsDatabase=new Re(e.platform.Storage),R.pingsDatabase=new Ie(e.platform.Storage),e.instance._pingUploader=new Me(c,e.platform,R.pingsDatabase),R.pingsDatabase.attachObserver(e.pingUploader),null==r?void 0:r.plugins)for(var l=0,f=r.plugins;l<f.length;l++)i=f[l],s=void 0,(s=i.event)in Ne?Ne[s].registerPlugin(i):console.error("Attempted to register plugin '"+i.name+"', which listens to the event '"+i.event+"'.","That is not a valid Glean event. Ignoring");R.dispatcher.flushInit((function(){return ut(u,void 0,void 0,(function(){var r;return ct(this,(function(i){switch(i.label){case 0:return R.applicationId=function(e){return e.replace(/[^a-z0-9]+/gi,"-").toLowerCase()}(t),R.debugOptions=c.debug,e.instance._config=c,[4,R.metricsDatabase.clear("application")];case 1:return i.sent(),R.initialized=!0,e.pingUploader.setInitialized(!0),n?[4,e.onUploadEnabled()]:[3,3];case 2:return i.sent(),[3,9];case 3:return[4,R.metricsDatabase.getMetric(o,e.coreMetrics.clientId)];case 4:return(r=i.sent())?r===a?[3,6]:[4,e.onUploadDisabled()]:[3,7];case 5:i.sent(),i.label=6;case 6:return[3,9];case 7:return[4,e.clearMetrics()];case 8:i.sent(),i.label=9;case 9:return[4,R.pingsDatabase.scanPendingPings()];case 10:return i.sent(),e.pingUploader.triggerUpload(),[2]}}))}))}))}else console.error("Unable to initialize Glean, environment has not been set.");else console.error("Unable to initialize Glean, applicationId cannot be an empty string.")},Object.defineProperty(e,"serverEndpoint",{get:function(){var t;return null===(t=e.instance._config)||void 0===t?void 0:t.serverEndpoint},enumerable:!1,configurable:!0}),Object.defineProperty(e,"logPings",{get:function(){var t,n;return(null===(n=null===(t=e.instance._config)||void 0===t?void 0:t.debug)||void 0===n?void 0:n.logPings)||!1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugViewTag",{get:function(){var t;return null===(t=e.instance._config)||void 0===t?void 0:t.debug.debugViewTag},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sourceTags",{get:function(){var t,n;return null===(n=null===(t=e.instance._config)||void 0===t?void 0:t.debug.sourceTags)||void 0===n?void 0:n.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){if(!e.instance._platform)throw new Error("IMPOSSIBLE: Attempted to access environment specific APIs before Glean was initialized.");return e.instance._platform},enumerable:!1,configurable:!0}),e.setUploadEnabled=function(t){var n=this;R.dispatcher.launch((function(){return ut(n,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return R.initialized?R.uploadEnabled===t?[3,4]:t?[4,e.onUploadEnabled()]:[3,2]:(console.error("Changing upload enabled before Glean is initialized is not supported.\n","Pass the correct state into `Glean.initialize\n`.","See documentation at https://mozilla.github.io/glean/book/user/general-api.html#initializing-the-glean-sdk`"),[2]);case 1:return n.sent(),[3,4];case 2:return[4,e.onUploadDisabled()];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}))},e.setLogPings=function(t){R.dispatcher.launch((function(){return e.instance._config.debug.logPings=t,Promise.resolve()}))},e.setDebugViewTag=function(t){O.validateDebugViewTag(t)?R.dispatcher.launch((function(){return e.instance._config.debug.debugViewTag=t,Promise.resolve()})):console.error("Invalid `debugViewTag` "+t+". Ignoring.")},e.unsetDebugViewTag=function(){R.dispatcher.launch((function(){return delete e.instance._config.debug.debugViewTag,Promise.resolve()}))},e.setSourceTags=function(t){O.validateSourceTags(t)?R.dispatcher.launch((function(){return e.instance._config.debug.sourceTags=t,Promise.resolve()})):console.error("Invalid `sourceTags` "+t.toString()+". Ignoring.")},e.unsetSourceTags=function(){R.dispatcher.launch((function(){return delete e.instance._config.debug.sourceTags,Promise.resolve()}))},e.setPlatform=function(t){R.initialized||(e.instance._platform&&e.instance._platform.name!==t.name&&console.debug('Changing Glean platform from "'+e.platform.name+'" to "'+t.name+'".'),e.instance._platform=t)},e.testInitialize=function(t,n,r){return void 0===n&&(n=!0),ut(this,void 0,void 0,(function(){return ct(this,(function(i){switch(i.label){case 0:return e.setPlatform(st),e.initialize(t,n,r),[4,R.dispatcher.testBlockOnQueue()];case 1:return i.sent(),[2]}}))}))},e.testUninitialize=function(){return ut(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return[4,R.testUninitialize()];case 1:return t.sent(),function(){for(var e in Ne)Ne[e].deregisterPlugin()}(),e.pingUploader?[4,e.pingUploader.clearPendingPingsQueue()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.testResetGlean=function(t,n,r){return void 0===n&&(n=!0),ut(this,void 0,void 0,(function(){return ct(this,(function(i){switch(i.label){case 0:return[4,e.testUninitialize()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,6,,7]),[4,R.eventsDatabase.clearAll()];case 3:return i.sent(),[4,R.metricsDatabase.clearAll()];case 4:return i.sent(),[4,R.pingsDatabase.clearAll()];case 5:case 6:return i.sent(),[3,7];case 7:return[4,e.testInitialize(t,n,r)];case 8:return i.sent(),[2]}}))}))},e}();var ft=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},ht=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},dt=function(e){function t(t,n){var r=e.call(this,"event",t)||this;return r.allowedExtraKeys=n,r}return ft(t,e),t.prototype.record=function(e){var t=this;R.dispatcher.launch((function(){return pt(t,void 0,void 0,(function(){var t,n,r,i,o,a,s,u;return ht(this,(function(c){switch(c.label){case 0:if(!this.shouldRecord(R.uploadEnabled))return[2];if(t=x(),n=void 0,e&&this.allowedExtraKeys)for(n={},r=0,i=Object.entries(e);r<i.length;r++)o=i[r],a=o[0],s=o[1],this.allowedExtraKeys.includes(a)?n[a]=s.substr(0,100):console.error("Invalid key index "+a);return u=new Le(this.category,this.name,t,n),[4,R.eventsDatabase.record(this,u)];case 1:return c.sent(),[2]}}))}))}))},t.prototype.testGetValue=function(e){return void 0===e&&(e=this.sendInPings[0]),pt(this,void 0,void 0,(function(){var t,n=this;return ht(this,(function(r){switch(r.label){case 0:return[4,R.dispatcher.testLaunch((function(){return pt(n,void 0,void 0,(function(){return ht(this,(function(n){switch(n.label){case 0:return[4,R.eventsDatabase.getEvents(e,this)];case 1:return t=n.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,t]}}))}))},t}(G);const bt={initialize:function(e,t,n){lt.setPlatform(st),lt.initialize(e,t,n)},setUploadEnabled:function(e){lt.setUploadEnabled(e)},setLogPings:function(e){lt.setLogPings(e)},setDebugViewTag:function(e){lt.setDebugViewTag(e)},unsetDebugViewTag:function(){lt.unsetDebugViewTag()},setSourceTags:function(e){lt.setSourceTags(e)},unsetSourceTags:function(){lt.unsetSourceTags()},_private:{PingType:tt,BooleanMetricType:F,CounterMetricType:W,DatetimeMetricType:re,EventMetricType:dt,StringMetricType:ue,UUIDMetricType:ye}}})(),Glean=t})();
//# sourceMappingURL=glean.js.map