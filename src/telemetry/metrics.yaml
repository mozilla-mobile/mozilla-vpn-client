# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# This file contains metrics definitions for metrics collected by the
# Mozilla VPN application using only the qtglean integration.

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

sample:
  addon_cta_clicked:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      User clicked primary CTA in an addon
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/4487
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1794825
    data_sensitivity:
      - interaction
    extra_keys:
      addon_id:
        description: Addon identifier
        type: string
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  addon_message_state_changed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The addon message' state changed
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/4487
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1794825
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      message_id:
        description: |
          Addon identifier
        type: string
      message_state:
        description: |
          Received, Notified, Read, or Dismissed
        type: string

  addon_state_changed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      An addon's state changed
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/4487
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1794825
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      addon_id:
        description: |
          Addon identifier
        type: string
      state:
        description: |
          Installed, Enabled, or Disabled
        type: string

  authentication_acnt_del_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has advanced in the authentication flow for the account deletion.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the authentication state, e.g. "sign-in", "sign-out",
          "totp", etc. The list of states can be found in
          `authenticationinapp.h`.
        type: string

  authentication_error:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user is shown an error while authenticating in the app.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      reason:
        description: |
          The error shown: Timeout | IncorrectPassword | InvalidEmail |
          InvalidOrExpiredVerificiationCode | InvalidTOTP | InvalidUnblockCode
        type: string

  authentication_inapp_error:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The authentication in app has failed for a non-handled FxA error.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1759345
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      errno:
        description: The FxA error number
        type: string
      validation:
        description: Extra validation string for errno 107
        type: string
      verificationmethod:
        description: Verification method to be used for errno 125
        type: string
      error:
        description: Error string
        type: string
      message:
        description: Extra error message
        type: string

  authentication_inapp_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has advanced in the authentication flow.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1759345
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the authentication state, e.g. "sign-in", "sign-out",
          "totp", etc. The list of states can be found in
          `authenticationinapp.h`.
        type: string

  authentication_sub_manage_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has advanced in the authentication flow for the
      subscription management.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the authentication state, e.g. "sign-in", "sign-out",
          "totp", etc. The list of states can be found in
          `authenticationinapp.h`.
        type: string

  bottom_navigation_bar_click:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has tapped a bottom navigation bar button.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      bar_button:
        description: |
          The name of the bar button tapped:
          ScreenMessaging | ScreenHome | ScreenSettings | Unknown
        type: string

  delete_account_clicked:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has clicked the “delete account” button from the
      account deletion view.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  guide_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has opened a guide from the tips and tricks page
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-2292
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1776499
    data_sensitivity:
      - interaction
    notification_emails:
      - mlichtenstein@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      id:
        description: |
          The id of the guide that was opened
        type: string

  guide_closed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has closed a guide from the tips and tricks page
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-2292
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1776499
    data_sensitivity:
      - interaction
    notification_emails:
      - mlichtenstein@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      id:
        description: |
          The id of the guide that was closed
        type: string
      duration_ms:
        description: |
          The amount of time that the user spent in the guide (in seconds)
        type: quantity
        unit: milliseconds

  error_alert_shown:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      A generic error alet is shown.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3320
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5525
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      task:
        description: The name of the task that has generated this error.
        type: string
      filename:
        description: |
          The filename that has triggered the error
        type: string
      linenumber:
        description: |
          The line number where the error has been triggered
        type: quantity

  non_default_language_used:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has chosen a default language.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3742
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5525
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      language_code:
        description: The language code chosen.
        type: string

  iap_g_no_sku_details:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      There was an attempt to initiate a purchase without an SKU
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_launchbillingflow_failed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The billing client failed to launch the billing Flow
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_unexpected_purchasestate:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The client encountered an unexpected non-purchased product
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_sku_without_month:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Google play did not send a monthCount for a sku
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_query_purchases_failed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The billing client failed to fetch purchases
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_query_sku_details_failed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The billing client failed to fetch the SkuDetails
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_billing_not_available:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The Billing Client was not able to setup itself
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_purchases_updated_failed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Encountered an error while processing incoming purchase updates
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3754
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774433
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      reason:
        description: |
          The reason of the failure. It can be:
          "item-already-owned","user-canceled","item-unavailable"
          "unknown-$someInteger" in case an unhandled error is added by google.
        type: string

  iap_g_purchases_update_is_null:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Got a "null" response while fetching purchase updates
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  iap_g_purchase_ack_failed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The billing client failed to acknowledge the purchase
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/1620
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1746457
    data_sensitivity:
      - technical
    notification_emails:
      - sstreich@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  app_permissions_view_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has opened the app permissions view
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  authentication_aborted:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has aborted the authentication flow.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  authentication_completed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has completed the authentication flow.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  authentication_failure:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The authentication flow has terminated with an error
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  authentication_failure_by_geo:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The authentication flow has terminated with a geo-restriction error
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  authentication_started:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has started the authentication flow.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  backend_failure_viewed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has been shown the "Something went wrong…" error view.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  get_help_clicked_initialize:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has clicked "Help" from the initial view.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  manage_account_clicked:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has clicked the `manage account` button
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  max_device_reached:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Device limit reached
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  notifications_view_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has opened the notifications view
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  settings_view_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has opened the settings
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  dns_settings_view_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has viewed the advanced DNS Settings
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/1242
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1759345
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  connectivity_handshake_timeout:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The connection handshake with the VPN server is taking too long, and has
      timed out.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-1595
      - https://mozilla-hub.atlassian.net/browse/VPN-2279
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1759345
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774439
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      server:
        description: |
          The mullvad server public key and the connection latency, packet
          loss, stddev.
        type: string
      transport:
        description:
          The Host network type (i.e wifi or 4g). Possible values are Unknown,
          Disconnected, Local, Site, Online
        type: string

  connectivity_stable:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The connection has been stable for more than 10 seconds after the
      activation
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-1595
      - https://mozilla-hub.atlassian.net/browse/VPN-2279
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1759345
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774439
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      server:
        description: The mullvad server public key
        type: string
      latency:
        description: Server response latency
        type: string
      loss:
        description: Number of package loss
        type: string
      stddev:
        description: Standard deviation of the ping responses
        type: string
      transport:
        description: |
          The Host network type (i.e wifi or 4g).
          Possible values are Unknown, Disconnected, Local, Site, Online
        type: string

  server_unavailable_error:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      A "Server unavailable" error has occured.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/4589
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/4594#issuecomment-1271601927
    data_sensitivity:
      - technical
    notification_emails:
      - brizental@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  app_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The application state flow (authenticating, subscribing, main, etc).
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3411
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1767028
    data_sensitivity:
      - technical
    notification_emails:
      - brizental@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the app state, e.g. "authenticating", "device-limit",
          "main", "subscription-needed", etc. The complete list is
          `app.h`'s `State` enum along with the `CustomState` enum in the
          app's header file (e.g. `mozillavpn.h`).
        type: string

  controller_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
      - vpnsession
    description: |
      The controller state flow (off, connecting, switching, etc).
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3449
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1770530
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the controller state, e.g. "off", "connecting",
          "switching", etc. The list can be found in `controller.h`.
        type: string

  controller_state_on:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Controller state is on.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2643
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1773423
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  controller_state_off:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Controller state is off. It is important to note that mobile reports of
      this event are likely to be unreliable because they come from an
      non-active background process which is not guaranteed to be alive.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/2643
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1773423
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  update_step:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The update flow (update required available, installer started, etc)
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3455
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1770531
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the update states. The list can be found in `updater.h`.
        type: string

  unhandled_sub_plan_interval:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      Unhandled subscription plan interval from the
      subscription management view.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - technical
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      interval:
        description: |
          Unhandled interval
        type: string
      interval_count:
        description: |
          Unhandled interval count
        type: quantity
        unit: months

  profile_flow_state_changed:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The profile flow state changed.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      state:
        description: |
          The name of the profile flow state. The list of states can be found in
          `profileflow.h`.
        type: string

  delete_account_requested:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user has clicked the “delete account” button from the profile view.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/3627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1774568
    data_sensitivity:
      - interaction
    notification_emails:
      - amarchesini@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  user_changed_endpoint_geo:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      User changed the geography (city, or cities if multihop) of the endpoint
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      server:
        description: |
          Which server changed:
          multiHopEntryServer | multiHopExitServer | singleHopServer
        type: string

  help_menu_help_center_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user selected the help center option within the help menu
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  help_contact_support_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user selected the contact support option within the help menu
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  support_case_submitted:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user submitted a support case
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  help_menu_view_logs_opened:
    type: event
    lifetime: ping
    send_in_pings:
      - main
    description: |
      The user selected the view logs option within the help menu
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

performance:
  time_to_main_screen:
    type: timing_distribution
    description: |
      The time the app took between starting and rendering the main screen.
    bugs:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/issues/4486
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5529#pullrequestreview-1253522353
    data_sensitivity:
      - technical
    notification_emails:
      - brizental@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    time_unit: microsecond

settings:
  connect_on_startup_active:
    type: boolean
    lifetime: ping
    description: |
      The status of whether the VPN is activated on device start
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4069
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - main
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  using_system_language:
    type: boolean
    lifetime: ping
    description: |
      Status of whether app is being used in language of the operating system
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4068
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - main
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

session:
  session_start:
    type: datetime
    description: |
      The time the user starts a VPN session from the app
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4064
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - vpnsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  session_end:
    type: datetime
    description: |
      The time the user ends a VPN session from the app
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4064
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - vpnsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  session_id:
    type: uuid
    lifetime: user
    description: |
      A unique identifier for each session. This is used to connect unique VPN
      sessions across pings, and as a safety check on edge cases of VPN
      activation/deactivation, such as a session being started/ended from mobile
      system settings.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4064
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/6303#pullrequestreview-1359040451
    send_in_pings:
      - vpnsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  installation_id:
    type: uuid
    lifetime: user
    description: |
      A unique identifier to connect the app and daemon Glean instances.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4712
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/7581#pullrequestreview-1544692201
    send_in_pings:
      - vpnsession
      - daemonsession
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  dns_type:
    type: string
    description: |
      The type of DNS a user has active:
      - NoCustomDNSAvailable: Custom DNS app feature isn't available
      - Default: App's default DNS server
      - Custom: User has provided a custom valid IP address for their DNS
      - BlockAds: One of app's privacy DNS options
      - BlockTrackers: One of app's privacy DNS options
      - BlockAdsAndTrackers: One of app's privacy DNS options
      - BlockMalware: One of app's privacy DNS options
      - BlockMalwareAndAds: One of app's privacy DNS options
      - BlockMalwareAndTrackers: One of app's privacy DNS options
      - BlockMalwareAndAdsAndTrackers: One of app's privacy DNS options
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-3630
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - vpnsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  apps_excluded:
    type: quantity
    unit: apps
    description: |
      The number of apps the user is excluding from the VPN tunnel
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4066
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/5702#issuecomment-1397761161
    send_in_pings:
      - vpnsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  daemon_session_start:
    type: datetime
    description: |
      (Mobile-only) The time the user starts a VPN session from the daemon or
      network extension
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4038
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/7513#pullrequestreview-1529674762
    send_in_pings:
      - daemonsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  daemon_session_end:
    type: datetime
    description: |
      (Mobile-only) The time the user ends a VPN session from the daemon or
      network extension
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4038
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/7513#pullrequestreview-1529674762
    send_in_pings:
      - daemonsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  daemon_session_id:
    type: uuid
    lifetime: user
    description: |
      (Mobile-only) A unique identifier for each session.
      This is used to connect unique VPN sessions across pings, and as a safety
      check on edge cases of VPN activation/deactivation, such as a session
      being started/ended from mobile system settings.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4038
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/7513#pullrequestreview-1529674762
    send_in_pings:
      - daemonsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  daemon_session_source:
    type: string
    description: |
      (Mobile-only) Where the VPN session started from, to determine how many
      sessions start outside the app. Values should be "app" or "system".
      "system" covers cases like system settings, autostart on boot, tile, etc.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4038
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/7513#pullrequestreview-1529674762
    send_in_pings:
      - daemonsession
    data_sensitivity:
      - interaction
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never

  daemon_silent_server_switch:
    type: event
    lifetime: ping
    send_in_pings:
      - daemonsession
    description: |
      (Mobile only) The daemon requests a silent server switch.

      Extra key only included on iOS.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-6406
    data_reviews:
      - TBA
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: never
    extra_keys:
      was_server_available:
        description: True when the daemon has a saved server to switch to, false otherwise.
        type: boolean

connection_health:
  changed_to_no_signal:
    type: event
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      The connection status changed to no signal.

      This event is recorded in both main application and daemon.
      The logic and cadence of health checks for each of these
      is not the same.

      A no signal event happens when the connection is showing issues,
      and a silent switch will not address the issue. Or when the connection
      is showing issues and there have been previous silent switches which
      did not address the issue.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  changed_to_unstable:
    type: event
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      The connection status changed to unstable.

      This event is recorded in both main application and daemon.
      The logic and cadence of health checks for each of these
      is not the same.

      An unstable event happens when the connection is showing issues,
      but silent switches may still address the issue.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  changed_to_stable:
    type: event
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      The connection status changed to stable.

      This event is recorded in both main application and daemon.
      The logic and cadence of health checks for each of these
      is not the same.

      Stable status is when the app is not in a no signal or unstable
      connection state.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1711123#c1
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  changed_to_pending:
    type: event
    lifetime: ping
    send_in_pings:
      - daemonsession
    description: |
      (iOS only) The connection status changed to pending.

      This event is recorded in daemon.

      Pending status is when the app is first started or when there is
      no internet.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-6406
    data_reviews:
      - TBA
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  no_signal_count:
    type: counter
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Count of times that the connection health check results
      in no signal.

      The health check counters must not be considered as markers of time.
      There is a possible situation in the health check (which calls the
      telemetry) which frequently results in more than one count per second.
      The situation: A health check is conducted because a network check did not
      return, and milliseconds later that network check returns and another
      health check is started because of the return.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  unstable_count:
    type: counter
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Count of times that the connection health check results
      in unstable.

      The health check counters must not be considered as markers of time.
      There is a possible situation in the health check (which calls the
      telemetry) which frequently results in more than one count per second.
      The situation: A health check is conducted because a network check did not
      return, and milliseconds later that network check returns and another
      health check is started because of the return.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  stable_count:
    type: counter
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Count of times that the connection health check succeeds.

      The health check counters must not be considered as markers of time.
      There is a possible situation in the health check (which calls the
      telemetry) which frequently results in more than one count per second.
      The situation: A health check is conducted because a network check did not
      return, and milliseconds later that network check returns and another
      health check is started because of the return.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-4700
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/6783#pullrequestreview-1407551157
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  pending_count:
    type: counter
    lifetime: ping
    send_in_pings:
      - daemonsession
    description: |
      (iOS only) Count of times that the connection health check is in pending.

      The health check counters must not be considered as markers of time.
      There is a possible situation in the health check (which calls the
      telemetry) which frequently results in more than one count per second.
      The situation: A health check is conducted because a network check did not
      return, and milliseconds later that network check returns and another
      health check is started because of the return.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-6406
    data_reviews:
      - TBA
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  no_signal_time:
    type: timing_distribution
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Time spent in no signal state.

      Only collected on desktop for vpnsession, as mobile apps
      frequently are relaunched during VPN sessions. It is
      collected in daemonsession for mobile clients.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  unstable_time:
    type: timing_distribution
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Time spent in unstable state.

      Only collected on desktop for vpnsession, as mobile apps
      frequently are relaunched during VPN sessions. It is
      collected in daemonsession for mobile clients.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  stable_time:
    type: timing_distribution
    lifetime: ping
    send_in_pings:
      - vpnsession
      - daemonsession
    description: |
      Time spent in stable state.

      Only collected on desktop for vpnsession, as mobile apps
      frequently are relaunched during VPN sessions. It is
      collected in daemonsession for mobile clients.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-5860
    data_reviews:
      - https://github.com/mozilla-mobile/mozilla-vpn-client/pull/9057#pullrequestreview-1868746289
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  pending_time:
    type: timing_distribution
    lifetime: ping
    send_in_pings:
      - daemonsession
    description: |
      (iOS only) Time spent in pending state.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-6406
    data_reviews:
      - TBA
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-07-15

  ping_analyzer_error:
    type: event
    lifetime: ping
    send_in_pings:
      - daemonsession
    description: |
      The iOS PingAnalyzer returned an error.
    bugs:
      - https://mozilla-hub.atlassian.net/browse/VPN-6406
    data_reviews:
      - TBA
    data_sensitivity:
      - technical
    notification_emails:
      - mcleinman@mozilla.com
      - vpn-telemetry@mozilla.com
    expires: 2024-08-15
